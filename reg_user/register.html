<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">		
	<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	<script src="https://kit.fontawesome.com/3826950c16.js" crossorigin="anonymous"></script>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>新增</title>
	<style>
		input{
			outline: none !important;
  			box-shadow:none !important;
		}
		.btn-register{
			background-color: rgb(255, 217, 0)
		}
		.btn-register:hover{
			background: #FFC300 !important;
		}
		.btn-login{
			background-color: rgb(79, 126, 255);
			color: #fff;
		}
		.btn-login:hover{
			background-color: #3067FF;
			color: #fff;
		}
		.error{
			border-color: #FF3F3F;
		}
		.success{
			border-color: #269700;
		}
	</style>
</head>
<body>
	<div class="container pt-4">
		<div class="row justify-content-center">
			<div class="col-12 col-md-4">
				<div class="card">
					<div class="card-header"><h3 class="my-0">新增使用者</h3></div>
					<div class="card-body">
						<form id="register-form" method="post">
							<div class="mb-3">
								<label for="userid" class="form-label">ID</label>
								<input type="text" class="form-control" id="userid" required>
							</div>
							<div class="mb-3">
								<label for="userpw" class="form-label">密碼</label>
								<input type="password" class="form-control" id="userpw" required>
							</div>
							<div class="mb-3">
								<label for="userpw_confirm" class="form-label">確認密碼</label>
								<input type="password" class="form-control" id="userpw_confirm" required>
							</div>
							<div class="row">
								<div class="col">
									<button type="submit" class="btn btn-primary w-100 btn-reg">新增</button>
								</div>
								<div class="col-6">
                                    <button type="reset" class="btn btn-secondary w-100" id="reset">清除</button>
                                </div>
							</div>							
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script>
		$(function(){
			$("#userid").keyup(function(){
				if($(this).val()!=''){
					$.ajax({
					url: 'reg_rpt_func.php',
					type: 'POST',
					data: {
						'userid' : $("#userid").val()
					},
					dataType: 'html'
					}).done(function (data){			
						if(data == "yes"){
							alert("此ID已存在,請使用其他ID!");
							$(".btn-reg").attr('disabled','disabled');
							$("#userid").removeClass('success').addClass('error');
						}
						else{
							$("#userid").removeClass('error').addClass('success');
							$(".btn-reg").removeAttr('disabled');
						}
					}).fail(function(jqXHR, textStatus, errorThrown){
						alert("有錯誤發生");
						console.log(jqXHR.reponseText);
					});				
				}
				else{
					$("#userid").removeClass('error').removeClass('success');
					$(".btn-reg").removeAttr('disabled');
				}				
			});

			$("#register-form").submit(function(){
				if($("#userpw").val() != $("#userpw_confirm").val()){
					$("#userpw").addClass('error');
					$("#userpw_confirm").addClass('error');
					alert("密碼與確認密碼不符,請再次確認!");
				}
				else{
					$.ajax({
					url: 'register_func.php',
					type: 'POST',
					data: {
						'userid' : $("#userid").val(), 
						'userpw' : $("#userpw").val()
					},
					dataType: 'html'
					}).done(function (data){				
						if(data == "yes"){
							alert("新增成功");	
							location.reload();			
						}
						else{
							alert("新增失敗,請確認電腦連線狀態")
						}
					}).fail(function(jqXHR, textStatus, errorThrown){
						alert("有錯誤發生");
						console.log(jqXHR.reponseText);
					});		
				}
				return false;
			});
		});	
	</script>
</body>
</html>